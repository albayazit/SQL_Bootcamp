# SQL BOOTCAMP

### SELECT
* SELECT - указывает на то, что мы хотим выбрать
* SELECT DISTINCT - выбирает уникальные значения
  
Внутренний запрос позволяет извлечь необходимые данные для внешнего запроса:
```
SELECT
	(SELECT name FROM person WHERE person.id = o.person_id)
AS NAME
```

**||** (или CONCAT) - оператор конкатенации строк. Используется для объединения значений столбцов и строковых литералов.
```
SELECT name || ' age:' || age || 
```
Для добавления ковычек необходимо экранирововать их: `''''`
### FROM
* FROM - указывает таблицу
Можно сокращать названия столбцов (через пробел новые имена):
```
FROM person_order o
```
### WHERE
* WHERE - указываются условия выбора
### ORDER
* ORDER BY - сортирует в алфавитном порядке
* ORDER BY ... DESC - сортирует в порядке убывания
* ORDER BY ... ASC - сортирует в порядке возростания

### JOIN
Соединение — это операция между двумя таблицами. Для понимания этой операции можно представить псевдокод, показывающий, как работает соединение без использования индексов:
```
FOR r in R LOOP
    FOR s in S LOOP
        if r.id = s.r_id then add(r,s)
        …
    END;
END;
```
- JOIN - соединяет две таблицы на основе общих столбцов
- NATURAL JOIN - автоматический соединяет все столбцы таблиц, на основе столбцов с общими названиями
- RIGHT JOIN (или RIGHT OUTER JOIN) соединяет две таблицы и возвращает все записи из правой таблицы (таблицы, указанной после RIGHT JOIN), даже если нет соответствующих записей в левой таблице. Если совпадение не найдено, соответствующие столбцы из левой таблицы заполняются NULL.
- LEFT JOIN то же самое что и RIGHT JOIN, но наоборот.
- CROSS JOIN возвращает декартово произведение двух таблиц, то есть каждая строка из первой таблицы соединяется с каждой строкой из второй таблицы. Результатом будет количество строк первой таблицы, умноженное на количество строк второй таблицы.
- FULL JOIN (или FULL OUTER JOIN) — это тип соединения в SQL, который объединяет результаты как LEFT JOIN, так и RIGHT JOIN. Он возвращает все строки из обеих таблиц, независимо от того, есть ли совпадение по условию соединения.
- Theta Join Использует произвольное условие соединения, а не только равенство.
- Semi Join Возвращает строки из первой таблицы, которые имеют соответствие во второй таблице, но не включает данные из второй таблицы.
- Anti Join Возвращает строки из первой таблицы, которые не имеют соответствия во второй таблице.

### EXIST, NOT IN
- EXIST - проверяет, возвращает ли подзапрос какие либо строки.
- NOT IN - проверяет, есть ли строка в подзапросе

### CASE
* CASE WHEN ... THEN ... ELSE ... END AS- вычисляет новый столбец, проверяя условие
```
SELECT
	(SELECT name FROM person WHERE person.id = o.person_id)
AS NAME,
	CASE WHEN (SELECT name FROM person WHERE person.id = o.person_id) = 'Denis' THEN true ELSE false END AS check_name
```

### CONSTANTS
* ... AND ... / ... OR ... - логические опреаторы И / ИЛИ
* BETWEEN - выборка между двумя значениями
* ... AS - назначает имя новому вычисляемому полю
* ... * - выбрать все

Можно использовать операторы сравнения (>, <, =, ...).
При этом, следует использовать скобки для выделения блоков.
```
WHERE (visit_date BETWEEN '2022-01-06' AND '2022-01-09')
	OR pizzeria_id = 2
```
### SETS

В реляционных базах данных множества (sets) используются для выполнения различных операций с результатами запросов. Эти операции позволяют объединять, вычитать и находить пересечения между наборами данных. Основные операторы множеств в SQL включают:

	1.	UNION [ALL]
	2.	EXCEPT [ALL]
	3.	INTERSECT [ALL]

Операторы множеств
	1.	UNION [ALL]
	•	UNION объединяет результаты двух или более запросов, исключая дубликаты.
	•	UNION ALL объединяет результаты двух или более запросов, включая дубликаты.
	2.	EXCEPT [ALL]
	•	EXCEPT возвращает строки из первого запроса, которые отсутствуют во втором запросе, исключая дубликаты.
	•	EXCEPT ALL возвращает строки из первого запроса, которые отсутствуют во втором запросе, включая дубликаты.
	3.	INTERSECT [ALL]
	•	INTERSECT возвращает строки, присутствующие в обоих запросах, исключая дубликаты.
	•	INTERSECT ALL возвращает строки, присутствующие в обоих запросах, включая дубликаты.

Основные правила работы с операторами множеств

	1.	Соответствие атрибутов: Количество и типы столбцов в запросах, объединяемых с помощью операторов множеств, должны совпадать.
	2.	Имена атрибутов: Имена столбцов в результирующем наборе данных определяются именами столбцов из первого запроса.

### Recursive

Рекурсивные запросы позволяют выполнять итеративные операции над данными, такие как работа с иерархическими структурами (например, организационными структурами, деревьями каталогов).

В PostgreSQL рекурсивные запросы создаются с использованием конструкции WITH RECURSIVE.

```
WITH RECURSIVE subordinates AS (
    SELECT employee_id, manager_id, name, 1 AS level
    FROM employees
    WHERE manager_id IS NULL -- Начальный запрос

    UNION ALL

    SELECT e.employee_id, e.manager_id, e.name, s.level + 1
    FROM employees e
    INNER JOIN subordinates s ON s.employee_id = e.manager_id -- Рекурсивный запрос
)
SELECT * FROM subordinates;
```

### Применение SQL множеств
SQL множества также полезны для вычисления различных метрик, таких как расстояние Жаккара между двумя объектами. Расстояние Жаккара измеряет сходство между двумя наборами данных.

Формула для вычисления коэффициента Жаккара:
`J(A, B) = |A x B| / |A + B|`

### Relational Expression
Любой SQL-запрос можно описать на математическом языке реляционной алгебры. Возникает вопрос: зачем изучать реляционную алгебру, если можно сразу писать запросы на SQL? Ответить на этот вопрос можно двояко: «Да» и «Нет».

	•	«Да», потому что вы действительно можете сразу написать запрос на SQL, если вы уже знаете синтаксис.
	•	«Нет», потому что знание реляционной алгебры важно для понимания ключевых аспектов, которые используются при планировании оптимизации запросов и при создании семантических запросов.

### Date
Операция ::date в SQL (в частности, в PostgreSQL) используется для приведения данных к типу date. Она является оператором приведения типа, который позволяет явно преобразовать значение в указанный тип данных.
`SELECT '2022-01-01'::date;`

### Functions
Функция generate_series(...) в PostgreSQL используется для создания ряда значений. Эта функция особенно полезна для генерации последовательностей чисел, дат или временных интервалов.
`generate_series(start, stop, step)`


CTE (Common Table Expression), или Общие Табличные Выражения, — это конструкция в SQL, которая позволяет определять временные результаты, которые могут быть использованы в последующих запросах. CTE создаются с использованием ключевого слова WITH и могут значительно упростить написание и понимание сложных SQL-запросов.

```
WITH cte_name AS (
    SELECT column1, column2, ...
    FROM table_name
    WHERE conditions
)
SELECT column1, column2, ...
FROM cte_name
WHERE other_conditions;
```